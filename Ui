local Library = {}

function Library.newUI()
    local UI = {}

    -- Create the main ScreenGui
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "LibraryUI"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = game.Players.LocalPlayer.PlayerGui

    -- Create the main frame
    UI.Frame = Instance.new("Frame")
    UI.Frame.Name = "MainFrame"
    UI.Frame.BackgroundColor3 = Color3.new(0, 0, 0)
    UI.Frame.BackgroundTransparency = 0.5
    UI.Frame.Size = UDim2.new(0, 400, 0, 300)
    UI.Frame.Position = UDim2.new(0.5, -200, 0.5, -150)
    UI.Frame.Parent = screenGui
    UI.Frame.BorderSizePixel = 0
    
    UI.Header = Instance.new("Frame")
    UI.Header.Name = "Header"
    UI.Header.BackgroundColor3 = Color3.new(0, 0, 0)
    UI.Header.BackgroundTransparency = 0.5
    UI.Header.Size = UDim2.new(1, 0, 0, 30)
    UI.Header.Position = UDim2.new(0, 0, 0, 0)
    UI.Header.Parent = UI.Frame

    -- Create the title
    UI.Title = Instance.new("TextLabel")
    UI.Title.Name = "Title"
    UI.Title.BackgroundColor3 = Color3.new(0, 0, 0)
    UI.Title.BackgroundTransparency = 0.5
    UI.Title.Size = UDim2.new(1, 0, 0, 30)
    UI.Title.Position = UDim2.new(0, 0, 0, 0)
    UI.Title.TextColor3 = Color3.new(1, 1, 1)
    UI.Title.Text = "Psithurism"
    UI.Title.Font = Enum.Font.SourceSansBold
    UI.Title.TextSize = 18
    UI.Title.Parent = UI.Header

    -- Create the tab container
    -- Create the tab container
    UI.TabContainer = Instance.new("ScrollingFrame")
    UI.TabContainer.Name = "TabContainer"
    UI.TabContainer.BackgroundColor3 = Color3.new(0, 0, 0)
    UI.TabContainer.BackgroundTransparency = 0.8
    UI.TabContainer.Size = UDim2.new(1, 0, 0, 30)  -- Adjusted height to fit the tabs
    UI.TabContainer.Position = UDim2.new(0, 0, 0, 30)  -- Positioned below the header
    UI.TabContainer.CanvasSize = UDim2.new(0, 0, 0, 0)  -- Initially set the CanvasSize to zero
    UI.TabContainer.ScrollBarThickness = 6
    UI.TabContainer.ScrollBarImageColor3 = Color3.new(0, 0, 0)
    UI.TabContainer.Parent = UI.Frame
    UI.TabContainer.BorderSizePixel = 0

    -- Create the content container
    UI.ContentContainer = Instance.new("Frame")
    UI.ContentContainer.Name = "ContentContainer"
    UI.ContentContainer.BackgroundColor3 = Color3.new(0, 0, 0)
    UI.ContentContainer.BackgroundTransparency = 0.8
    UI.ContentContainer.Size = UDim2.new(1, -10, 1, -60)  -- Adjusted size to leave space for the tab container and scrolling
    UI.ContentContainer.Position = UDim2.new(0, 5, 0, 60)  -- Positioned below the header and to the right of the tab container
    UI.ContentContainer.Parent = UI.Frame
    UI.ContentContainer.BorderSizePixel = 0

    -- Create a function to add tabs
    function UI:AddTab(name)
        local Tab = {}

        -- Create the tab button
        Tab.Button = Instance.new("TextButton")
        Tab.Button.BackgroundColor3 = Color3.new(0, 0, 0)
        Tab.Button.BackgroundTransparency = 0.5
        Tab.Button.BorderSizePixel = 0
        Tab.Button.Size = UDim2.new(1, 0, 0, 30)
        Tab.Button.Position = UDim2.new(0, 0, 0, (#UI.TabContainer:GetChildren() + 1) * 30 - 30)
        Tab.Button.TextColor3 = Color3.new(1, 1, 1)
                Tab.Button.Text = name
        Tab.Button.Font = Enum.Font.Gotham
        Tab.Button.TextSize = 14
        Tab.Button.Parent = UI.TabContainer

        -- Create the tab content frame
        Tab.Content = Instance.new("Frame")
        Tab.Content.BackgroundColor3 = Color3.new(0, 0, 0)
        Tab.Content.BackgroundTransparency = 0.5
        Tab.Content.Size = UDim2.new(1, 0, 1, 0)
        Tab.Content.Position = UDim2.new(0, 0, 0, 0)
        Tab.Content.Visible = false
        Tab.Content.Parent = UI.ContentContainer

        -- Connect the button click event to show the tab content
        Tab.Button.MouseButton1Click:Connect(function()
            for _, content in pairs(UI.ContentContainer:GetChildren()) do
                content.Visible = false
            end
            Tab.Content.Visible = true
        end)

        return Tab
    end

    -- Create a function to add buttons
    function UI:AddButton(parent, text, callback)
        local Button = Instance.new("TextButton")
        Button.BackgroundColor3 = Color3.new(0, 0, 0)
        Button.BackgroundTransparency = 0.5
        Button.BorderSizePixel = 0
        Button.Size = UDim2.new(0, 150, 0, 50)
        Button.Position = UDim2.new(0.5, -75, 0.5, -25)
        Button.TextColor3 = Color3.new(1, 1, 1)
        Button.Text = text
        Button.Font = Enum.Font.Gotham
        Button.TextSize = 14
        Button.Parent = parent.Content

        -- Connect the button click event to the callback function
        Button.MouseButton1Click:Connect(callback)

        return Button
    end

    -- Create a function to add a toggle switch
    function UI:AddToggle(parent, text, defaultState, callback)
        local Toggle = {}

        Toggle.Container = Instance.new("Frame")
        Toggle.Container.BackgroundTransparency = 1
        Toggle.Container.Size = UDim2.new(1, 0, 0, 30)
        Toggle.Container.Position = UDim2.new(0, 0, 0, (#parent.Content:GetChildren() + 1) * 30 - 30)
        Toggle.Container.Parent = parent.Content

        Toggle.Label = Instance.new("TextLabel")
        Toggle.Label.BackgroundColor3 = Color3.new(0, 0, 0)
        Toggle.Label.BackgroundTransparency = 0.5
        Toggle.Label.Size = UDim2.new(1, -50, 1, 0)
        Toggle.Label.Position = UDim2.new(0, 0, 0, 0)
        Toggle.Label.TextColor3 = Color3.new(1, 1, 1)
        Toggle.Label.Text = text
        Toggle.Label.Font = Enum.Font.Gotham
        Toggle.Label.TextSize = 14
        Toggle.Label.Parent = Toggle.Container

        Toggle.Switch = Instance.new("TextButton")
        Toggle.Switch.BackgroundColor3 = Color3.new(0, 0, 0)
        Toggle.Switch.BackgroundTransparency = 0.5
        Toggle.Switch.BorderSizePixel = 0
        Toggle.Switch.Size = UDim2.new(0, 40, 0, 20)
        Toggle.Switch.Position = UDim2.new(1, -45, 0.5, -10)
                Toggle.Switch.TextColor3 = Color3.new(1, 1, 1)
        Toggle.Switch.Text = ""
        Toggle.Switch.Font = Enum.Font.SourceSans
        Toggle.Switch.TextSize = 14
        Toggle.Switch.Parent = Toggle.Container

        local switchState = defaultState

        -- Function to update the toggle switch visual state
        local function updateSwitchVisual()
            if switchState then
                Toggle.Switch.BackgroundColor3 = Color3.new(0, 1, 0)
                Toggle.Switch.Position = UDim2.new(1, -45, 0.5, -10)
            else
                Toggle.Switch.BackgroundColor3 = Color3.new(1, 0, 0)
                Toggle.Switch.Position = UDim2.new(0, 5, 0.5, -10)
            end
        end

        -- Connect the toggle switch click event
        Toggle.Switch.MouseButton1Click:Connect(function()
            switchState = not switchState
            updateSwitchVisual()
            callback(switchState)
        end)

        -- Update the initial toggle switch visual state
        updateSwitchVisual()

        return Toggle
    end

    return UI
end

return Library.newUI()
